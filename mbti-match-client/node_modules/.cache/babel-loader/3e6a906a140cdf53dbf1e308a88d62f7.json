{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\test\\\\mbti-match-client-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\test\\\\mbti-match-client-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\test\\\\mbti-match-client-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useSelector,useDispatch}from'react-redux';import InputPanel from'../components/ChatView/InputPanel';import View from'../components/ChatView/View';import BackTab from'../components/BackTab/BackTab';import{useParams}from'react-router-dom';import{getChat,postNewMessage}from'../api';import{enterChatRoom,addNewMessage,leaveRoom}from'../actions';import{objectKeysToCamelCase}from'../utility/formattingData';var ChatView=function ChatView(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var _useSelector=useSelector(function(state){return{client:state.client,user:state.user,currentRoomChat:state.currentRoomChat};}),client=_useSelector.client,user=_useSelector.user,currentRoomChat=_useSelector.currentRoomChat;var dispatch=useDispatch();var _useParams=useParams(),roomId=_useParams.roomId;var userId=user.id;useEffect(function(){var setChat=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var chat;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getChat(roomId);case 2:chat=_context.sent;dispatch(enterChatRoom(objectKeysToCamelCase(chat)));case 4:case\"end\":return _context.stop();}}},_callee);}));return function setChat(){return _ref.apply(this,arguments);};}();setChat();client.joinRoom({roomId:roomId,userId:userId});client.receiveNewMessage(function(data){dispatch(addNewMessage({createAt:new Date(),content:data.message,speaker:data.userId}));});return function(){client.leaveRoom(roomId);dispatch(leaveRoom());};},[]);var onMessageChange=function onMessageChange(ev){var value=ev.currentTarget.value;setMessage(value);};var handleSubmit=function handleSubmit(){if(!message)return;client.sendMessage({roomId:roomId,userId:userId,message:message});postNewMessage(roomId,{message:message});setMessage('');};var handleKeyPress=function handleKeyPress(ev){if(ev.key==='Enter'){handleSubmit();}};return React.createElement(React.Fragment,null,currentRoomChat.hasOwnProperty('partner')&&React.createElement(BackTab,{title:currentRoomChat.partner.name||''}),React.createElement(View,{chats:currentRoomChat,user:user}),React.createElement(InputPanel,{onMessageChange:onMessageChange,message:message,onKeyPress:handleKeyPress,onSubmit:handleSubmit,chat:currentRoomChat}));};export default ChatView;","map":{"version":3,"names":["React","useState","useEffect","useSelector","useDispatch","InputPanel","View","BackTab","useParams","getChat","postNewMessage","enterChatRoom","addNewMessage","leaveRoom","objectKeysToCamelCase","ChatView","_useState","_useState2","_slicedToArray","message","setMessage","_useSelector","state","client","user","currentRoomChat","dispatch","_useParams","roomId","userId","id","setChat","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","chat","wrap","_callee$","_context","prev","next","sent","stop","apply","arguments","joinRoom","receiveNewMessage","data","createAt","Date","content","speaker","onMessageChange","ev","value","currentTarget","handleSubmit","sendMessage","handleKeyPress","key","createElement","Fragment","hasOwnProperty","title","partner","name","chats","onKeyPress","onSubmit"],"sources":["C:/test/mbti-match-client-master/src/containers/ChatView.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport InputPanel from '../components/ChatView/InputPanel';\nimport View from '../components/ChatView/View';\nimport BackTab from '../components/BackTab/BackTab';\nimport { useParams } from 'react-router-dom';\nimport { getChat, postNewMessage } from '../api';\nimport { enterChatRoom, addNewMessage, leaveRoom } from '../actions';\nimport { objectKeysToCamelCase } from '../utility/formattingData';\n\nconst ChatView = () => {\n  const [message, setMessage] = useState('');\n  const { client, user, currentRoomChat } = useSelector(state => ({\n    client: state.client,\n    user: state.user,\n    currentRoomChat: state.currentRoomChat\n  }));\n  const dispatch = useDispatch();\n  const { roomId } = useParams();\n  const userId = user.id;\n\n  useEffect(() => {\n    const setChat = async () => {\n      const chat = await getChat(roomId);\n      dispatch(enterChatRoom(objectKeysToCamelCase(chat)));\n    };\n\n    setChat();\n\n    client.joinRoom({ roomId, userId });\n\n    client.receiveNewMessage(data => {\n      dispatch(\n        addNewMessage({\n          createAt: new Date(),\n          content: data.message,\n          speaker: data.userId\n        })\n      );\n    });\n\n    return () => {\n      client.leaveRoom(roomId);\n      dispatch(leaveRoom());\n    };\n  }, []);\n\n  const onMessageChange = ev => {\n    const { value } = ev.currentTarget;\n    setMessage(value);\n  };\n\n  const handleSubmit = () => {\n    if (!message) return;\n    client.sendMessage({ roomId, userId, message });\n    postNewMessage(roomId, { message });\n    setMessage('');\n  };\n\n  const handleKeyPress = ev => {\n    if (ev.key === 'Enter') {\n      handleSubmit();\n    }\n  };\n\n  return (\n    <>\n      {currentRoomChat.hasOwnProperty('partner') && (\n        <BackTab title={currentRoomChat.partner.name || ''} />\n      )}\n      <View chats={currentRoomChat} user={user} />\n      <InputPanel\n        onMessageChange={onMessageChange}\n        message={message}\n        onKeyPress={handleKeyPress}\n        onSubmit={handleSubmit}\n        chat={currentRoomChat}\n      />\n    </>\n  );\n};\n\nexport default ChatView;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}